1.autoinstall
  - vytvort konf. soubor (na zivem systemu je v /root/anaconda-ks.cfg)
  - upravit rucne (gui neumi lvm)
  - zkontrolovat pomoci ksvalidator
  - zpristupnit ho, napr. pomoci http
  - zkontrolovat zda je skutecne dostupny (wget, links)
  - restart --> ctrl+b --> autoboot --> TAB --> upravit spusteci parametry - pridat ks=http://server/cesta_k_souboru/soubor

2.commandline
  - rhel6 = 6 konzoli
  - prepinani ctrl+alt+f[123456]

3.advanced commandline
  - a symlink can be used across file systems
  - a hard link increase the link count
  - when you create a hard link you can remove the original file without losing data
  ln /tmp/source1 hardlink
  ls -li
  ln -s /tmp/source2 symlink
  
  tar options
    c = create
    x = extract
    t = test
    v = verbose
    f = file name
    z = gzip 
    j = bzip2
    j = xz
    
    tar cvzf /tmp/zdroj.tar.gz /tmp/zdroj.txt
    tar xvf zdroj.tar.gz
    
    cat /etc/services | egrep '(microsoft)|(netbios)'
4.regex&pipelines & i/o redirection    
    regex
    - line begins with "Test" or "test":        ^[Tt]est
    - line ends with "end."                     end\.$
    - the entire line is Hello world.           ^Hello world\.$
    - any of the following names file5 file6    file[56]
    
    ls /usr/share/doc |grep '4$'
    grep '[0-9]' /etc/hosts
    grep '127.\0.\.0\.1' /etc/hosts
    
    find /etc -name 'host*' > /tmp/output.txt 2> /tmp/error.txt
    find /etc -name 'host*' > /tmp/all.txt 2>&1

5.networking
    neinstalovat biosdevname - pak muze mit sitovka nazev dle typu, ne ethX atp.
    ip addr show eth0 
    ip -s link show eth0
    ip -6 route
    /etc/hosts - lokalni dns
    /etc/resolv.conf - dns
    /etc/sysconfig/network - gw, hostname
    /etc/sysconfig/network-scripts/ifcfg-ethX
    
    ifcfg:
    BOOTPROTO={static,dhcp}
    IPADDR=192.168.0.240
    NETMASK=255.255.255.0
    GATEWAY=192.168.0.254
    DNS1=
    ONBOOT=yes
    NM_CONTROLLED=yes
    
    service network restart
    
    route add default gw 192.168.1.1 eth0  - pridani default route 

    = alias ============================
    
    service NetworkManager stop && chkconfig NetworkManager off        
    [root@server1 ~]# cat /etc/sysconfig/network-scripts/ifcfg-eth0:0
    DEVICE=eth0:0
    IPADDR=192.168.1.10
    NETMASK=255.255.255.0
    ONPARENT=yes

    = bonding ==========================
    
    /usr/share/doc/kernel-doc-2.6.32/Documentation/networking/bonding.txt
    
    [root@server3 ~]# cat /etc/sysconfig/network-scripts/ifcfg-bond0
    DEVICE=bond0
    IPADDR=192.168.1.110
    NETMASK=255.255.255.0
    ONBOOT=yes
    BOOTPROTO=none
    USERCTL=no
    BONDING_OPTS="mode=1 miimon=50"
    
    each slave interface needs a file containing the following:
    [root@server3 ~]# cat /etc/sysconfig/network-scripts/ifcfg-eth1 |head -n 3
    MASTER=bond0
    SLAVE=yes
    USECTL=no
    ONBOOT=yes
    BOOTPROTO=none
    
    #status
    watch -n .1 "cat /proc/net/bonding/bond0"
    
6.partitions and fs
    8e (LVM flag); 82 (Linux swap flag)
    fdisk -cul |grep -i /dev/vda[0-9]
    fdisk -cu /dev/vda
    blkid /dev/vda1 - vypise UUID - pouziva se pro fstab
    cat /proc/partitions -aktualni oddily
    mkfs -t ext4 /dev/vda3
    
    swapon -s   -zobrazi stav swapu
    free        -zobrazi stav pouzivani swapu
    mkswap /dev/...  -naformatuje swap oddil (oddil vytvorit fdiskem, kod 82)
    swapon -a   -namountuje vsechny swapy z fstabu      UUID=... swap swap defaults 0 0
    swapoff /dev/...
    
    encrypted partition:
    fdisk - vytvorit partisnu napr. /dev/vda6
    cat /dev/urandom > /dev/vda6
    cryptsetup luksFormat /dev/vda6
    cryptsetup luksOpen /dev/vda6 /vault
    echo "/vault /dev/vda6" >> /etc/crypttab
    mkfs -t ext4 /dev/mapper/vault
    blkid /dev/mapper/vault
    mkdir /mnt/vault
    echo "UUID=... /mnt/vault ext4 defaults 1 2" >> /etc/fstab
    mount -a   
    
    echo -n "heslo" > /root/heslo.txt
    chown root /root/heslo.txt
    chmod 600 /root/heslo.txt
    cryptsetup luksAddKey /dev/vda6 /root/heslo.txt
    echo "jmenoVolume /dev/vda6 /root/heslo.txt" > /etc/crypttab #jmenoVolume ma svoje blkid -> fstab"

7.LVM
    pvs, vgs, lvs
    fdisk -cu /dev/sda (kod part. 8e)
    pvcreate /dev/sda2
    vgcreate vg1 /dev/sda2
    lvcreate -n lv1 -L100M vg1    
    mkfs -t ext4 /dev/vg1/lv1
    
    vgextend vg1 /dev/sda2
    lvextend -r -L +200M /dev/vg1/lv1  - L=velikost v jednotkach si | l=velikost v PE
    resize2fs /dev/vg1/lv1  - pokud na lvextend nebyl pouzit parametr -r
    
    lvcreate -n lv1_snap -L50M /dev/vg1/lv1 - vytvoreni snapshotu
    mount -o ro /dev/vg1/lv1_snap - namountovat snapshot read only
    
8.NFS
    showmount -e server (fqdn)
    mkdir /mnt/servershare
    mount server:/var/ftp/pub /mnt/servershare
    umount /mnt/servershare
    
    autofs
    echo "/home/guests /etc/auto.guests" >> /etc/auto.master
    echo "* -rw server:/home/guests/&" >> /etc/auto.guests
    service autofs stop
    service autofs start
    
9. User accounts      
    id username
    
    useradd username
    userdel username
    
    groupadd groupname
    groupdel groupname
    
    usermod -aG linuxteam olie  - prida oliemu dalsi skupinu linuxteam
    usermod -L elvis - zamkne elvise
    usermod -U elvis - odemkne elvise
    chage -l elvis - aktualni nastaveni
    chage -E 2014-03-15   - ucet expiruje
          -d 0            - vynucena zmena hesla pri logonu
          -I 10           - potom co heslo expiruje je jeste 10 dnu mozne zmenit, pak volat helpdesk
          -W 2            - varovat pred tim nez si musis zmenit heslo
    
    
    for name in user1 user2 user3
    do
        useradd $name
        echo "pass" | passwd --stdin $name
    done        

10.LDAP    
    /etc/sssd.conf
    /etc/init.d/sssd
    enumerate=true   - vrati vsechny usery z ldapu
    debug_level=8    - logovani
    service sssd restart
    
    system-config-authentication
    getent passwd user  - je user v ldapu
    ldap: dc=example,dc=com   
    TLS encrypt
    down certificate
    
11.ACL
    acl je vlastnost FS, pridat: tune2fs -o acl,user_xattr /dev/sda1
    chmod ugo+-rwxst /tmp/soubor
    s = sticky bit pro owner = spustena app bezi pod pravy vlastnika (napr. /bin/usr/passwd)
    s = sticky bit pro group = inheritance adresare
    t = sticky bit pro others = vlastnik si muze smazat svuj soubor    
    
    getfacl /tmp/test
    
    setfacl -m user:olie:rwx /tmp/test
    setfacl -d -m user:olie:rwx /tmp/test

12.SELinux
    /etc/sysconfig/selinux
    SELINUX=permissive
    setenforce 1   -enforcing
    setenforce 0   -permissive
    restorecon /etc/resolv.conf
    restorecon -Rv /var/www/html
    restorecon -R -v /root/.ssh
    
    /var/log/audit/audit.log
    
    sealert -a /var/log/audit/audit.log
    
    getsebool -a | grep httpd
    setsebool -P httpd_can_network_connect_db 1   #httpd muze na sit(treba do mysql)- P= jak v pameti, tak na disku
    
    
    
    yum install policycoreutils-python #prida semanage



    [root@server1 ~]# semanage login -l
    
    Login Name                SELinux User              MLS/MCS Range
    
    __default__               unconfined_u              s0-s0:c0.c1023
    root                      unconfined_u              s0-s0:c0.c1023
    system_u                  system_u                  s0-s0:c0.c1023
    [root@server1 ~]# adduser olie
    [root@server1 ~]#
    [root@server1 ~]# semanage login -a -s user_u olie
    [root@server1 ~]#
    [root@server1 ~]# semanage login -l
    
    Login Name                SELinux User              MLS/MCS Range
    
    __default__               unconfined_u              s0-s0:c0.c1023
    olie                      user_u                    s0
    root                      unconfined_u              s0-s0:c0.c1023
    system_u                  system_u                  s0-s0:c0.c1023
    [root@server1 ~]#
    [root@server1 ~]# semanage login -d olie    
    [root@server1 ~]# semanage login -l
    
    Login Name                SELinux User              MLS/MCS Range
    
    __default__               unconfined_u              s0-s0:c0.c1023
    root                      unconfined_u              s0-s0:c0.c1023
    system_u                  system_u                  s0-s0:c0.c1023
    
    
    
    semanage port -a -t ssh_port_t -p tcp 2222  #povoleni portu tcp2222 pro sshd demona
    semanage fcontext -a -t httpd_sys_content_t "/weby(/.*)?" #do /weby/* je prirazen kontext web obsahu
   
    
    
13.Installing and Managing sw
    
    yum info
        search
        list
        install
        remove
        update
        provides
        grouplist
        groupinfo
        groupinstall
        grouperase
        groupupdate
    
    rpm -qa
        -qc
        -qd
        -qp <file.rpm>
        -q --scripts                

    rpm --import http://cestakcertifikatu
    
    /etc/yum.repos.d/repository.repo
    
    [name]
    name=moje repo
    baseurl=http://
    gpgcheck=1
    gpgkey=
    enabled=1
    
14.Managing services
    service <name> stop|start|status|...
    
    netstat -tulpn|grep -i httpd
    ps aux|grep -i httpd
    lsof -i  (i pro porty)
    nc server 80 
    
    chkconfig --list|grep -i httpd
    chkconfig --level 345 httpd on
    chkconfig httpd on

15.Logs    
    /etc/rsyslog.conf
    
    *.*         /var/log/all
    cron.debug  /var/log/cro
    mail.*      -/var/log/maillog
    *.*         ~/var/log/   
    
    logwatch
    /etc/logwatch/conf/logwatch.conf
    
    logger -i "zprava do logu"   - posle zpravu do rsyslogu
    
    zprava obsahujici IPTABLES:DROP pujde do iptables.log a pak se zahodi
    :msg, startswith, "IPTABLES:DROP"     /var/log/iptables.log
    :msg, startswith, "IPTABLES:DROP"     ~
                                                                         
16.Processes
    ps aux
    top  - do menu klavesou O, k = kill, r = renice
    
    renice
    kill -9
    
    cron
    /etc/cron.{daily,weekly,monthly}
    /etc/anacrontab
    
    echo "reboot" | at now +2 min
    
    at 3pm
    at 2013.11.28
       teatime today 
       teatime tomorrow
    
    atq
    atrm 3
    
17.Kernel
    /etc/sysctl.conf
    
    man_loop = 32
    console = /dev...
    net.ipv4...
    
    doinstalovat kernel-doc    
    
    lsmod    - nactene moduly

    sysctl -a |grep icmp
    echo "net.ipv4.icmp_echo_ignore_all=1" >> /etc/sysctl.conf
    sysctl -p           
    
    GRUB
    grup-md5-crypt
    /etc/grub.conf
    password --md5 <string_z_grup-md5-crypt>
    
    start systemu:
    /etc/rc.d/rc.sysinit
    /etc/inittab  ----- runlevel
    /etc/init/start-ttys.conf
    /etc/init/rc.conf
    

18.System recovery   
    /etc/fstab - chybny nazev
    /etc/initbat - spatny runlevel
    /etc/grub.conf - spatny zaznam v grub prikazu
    nevime heslo - do single mode
    
===================================================================================================
===================================================================================================
===================================================================================================

19.Linux RAID
    vytvarime na partitions, ty musi mit 'fd' typ
    na disku /dev/sdb a /dev/sdc vytvorime partitions 'fd'
    
    mdadm --examine /dev/sdb1 /dev/sdc1     nesmi mit v sobe superblock
    mdadm --create /dev/md0 --level=mirror --raid-devices=2 /dev/sdb1 /dev/sdc1
    mkfs.ext4 /dev/md0
    mount /dev/md0 /mnt
    blkid /dev/md0 -> blkid zapsat do /etc/fstab
    
    mdadm --fail /dev/md0 /dev/sdb1   oznaceni disku za vadny
    mdadm --remove /dev/md0 /dev/sdb1   odstraneni disku z pole
    
    mdadm --manage /dev/md0 --add /dev/db1  pripadni disku do pole
    
    mdadm --grow --raid-devices=2 /dev/md0  nastavit pocet disku v poli
    
    cat /proc/mdadm   informace o aktualnim deni v poli
    mdadm --detail /dev/md0 informace o poli
    mdadm --detail --scan --verbose > /etc/mdadm/mdadm.conf   vytvoreni config file
    mdadm --detail `df | grep /dev/md | awk '{print $1}'` | grep -i state | head -n 1 | awk '{print $3}'
    
20.NTP
    [root@adelard ~]# rpm -qa |grep -i ntp
    ntpdate-4.2.6p5-1.el6.centos.i686
    ntp-4.2.6p5-1.el6.centos.i686    
    
    ntpq -p                 - informace o synchronizaci - hvezdicka na zacatku u serveru znaci, ze se synchronizuje
    ntpdc -n -c monlist     - info o probehlych synchronizacich                                                                 

    iptables -I INPUT -p udp --dport 123 -j ACCEPT    - povoleni portu udp123 (ntp server)

    /etc/ntp.conf
    {
    restrict default kod nomodify notrap
    restrict -6 default kod nomodify notrap
    
    server ntp.ujf.cas.cz prefer
    server time.windows.com
    
    server          127.127.1.0     # local clock
    fudge           127.127.1.0 stratum 10
    
    driftfile       /var/lib/ntp/drift
    broadcastdelay  0.008
    keys            /etc/ntp/keys
    
    logfile /var/log/ntpd.log
    }               

21.SAMBA

22.IPTables
    
  /etc/sysconfig/iptables
      
  [root@tester1 log]# iptables -vnL --line-numbers
  Chain INPUT (policy DROP 0 packets, 0 bytes)
  num   pkts bytes target     prot opt in     out     source               destination
  1        0     0 ACCEPT     all  --  lo     *       0.0.0.0/0            0.0.0.0/0
  2        0     0 ACCEPT     icmp --  *      *       0.0.0.0/0            0.0.0.0/0           icmp type 0
  3        0     0 ACCEPT     icmp --  *      *       0.0.0.0/0            0.0.0.0/0           icmp type 3
  4        0     0 ACCEPT     icmp --  *      *       0.0.0.0/0            0.0.0.0/0           icmp type 11
  5        0     0 ACCEPT     icmp --  *      *       0.0.0.0/0            0.0.0.0/0           icmp type 8
  6      174 28835 ACCEPT     all  --  *      *       0.0.0.0/0            0.0.0.0/0           state RELATED,ESTABLISHED
  7        2   152 ACCEPT     tcp  --  *      *       0.0.0.0/0            0.0.0.0/0           state NEW tcp dpt:22
  8        1    52 ACCEPT     tcp  --  *      *       192.168.1.21         0.0.0.0/0           state NEW tcp dpt:80
  9       71  5003 LOG        all  --  *      *       0.0.0.0/0            0.0.0.0/0           LOG flags 0 level 4 prefix `IPTABLES:DROP '
  10      71  5003 DROP       all  --  *      *       0.0.0.0/0            0.0.0.0/0
  
  Chain FORWARD (policy DROP 0 packets, 0 bytes)
  num   pkts bytes target     prot opt in     out     source               destination
  
  Chain OUTPUT (policy ACCEPT 182 packets, 23042 bytes)
  num   pkts bytes target     prot opt in     out     source               destination
  [root@tester1 log]#
  [root@tester1 log]# cat /etc/sysconfig/iptables
  *filter
  :INPUT DROP [0:0]
  :FORWARD DROP [0:0]
  :OUTPUT ACCEPT [21:2120]
  
  -A INPUT -i lo -j ACCEPT
  -A INPUT -p icmp -m icmp --icmp-type 0 -j ACCEPT
  -A INPUT -p icmp -m icmp --icmp-type 3 -j ACCEPT
  -A INPUT -p icmp -m icmp --icmp-type 11 -j ACCEPT
  -A INPUT -p icmp -m icmp --icmp-type 8 -j ACCEPT
  -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
  
  -A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT
  -A INPUT -s 192.168.1.21/32 -p tcp -m state --state NEW -m tcp --dport 80 -j ACCEPT
  -A INPUT -s 192.168.1.20/32 -p tcp -m state --state NEW -m multiport --dports 443,5555 -j ACCEPT
  
  -A INPUT -j LOG --log-prefix "IPTABLES:DROP "
  -A INPUT -j DROP
  COMMIT
  [root@tester1 log]#
  
  
  PORTFORWARDING
  *nat
  :PREROUTING ACCEPT [0:0]
  :OUTPUT ACCEPT [0:0]
  :POSTROUTING ACCEPT [0:0]
  -A POSTROUTING -o eth+ -j MASQUERADE
  -A PREROUTING -i eth+ -p tcp --dport 80 -j DNAT --to-destination 192.168.21.122:80
  COMMIT
  *filter
  :INPUT ACCEPT [0:0]
  :FORWARD ACCEPT [0:0]
  :OUTPUT ACCEPT [0:0]
  -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
  -A INPUT -p icmp -j ACCEPT
  -A INPUT -i lo -j ACCEPT
  -A INPUT -i eth+ -j ACCEPT
  -A INPUT -m state --state NEW -m tcp -p tcp --dport 22 -j ACCEPT
  -A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT
  -A FORWARD -m state --state ESTABLISHED,RELATED -j ACCEPT
  -A FORWARD -p icmp -j ACCEPT
  -A FORWARD -i lo -j ACCEPT
  -A FORWARD -i eth+ -j ACCEPT
  -A FORWARD -o eth+ -j ACCEPT
  -A FORWARD -i eth+ -m state --state NEW -m tcp -p tcp -d 192.168.21.122 --dport 80 -j ACCEPT
  -A INPUT -j REJECT --reject-with icmp-host-prohibited
  -A FORWARD -j REJECT --reject-with icmp-host-prohibited  
  COMMIT
  

23. SSH port forwarding
  ssh -L 12345:localhost:80 serverX
  ssh -Nf -L 12345:localhost:80 serverX
  ====================================
  ~/.ssh/config
      host serverx
        user root
        LocalForward 12345 serverx:80    

  [root@server2 ~]# ssh serverx
  
  
24. DNS
  yum install bind
  
  (allow connections to ports udp53 and tcp53)
  
  /etc/named.conf
  
    listen-on port 53 {any;};
    listen-on-v6 port 53 {any;};
    
    dnssec-validation no;
    
    allow-query {localhost; 192.168.1.0/24;};
    forwarders {192.168.1.1;};
   
   service named start && chkconfig named on          
   
25. RPMBUILD

[root@server4 ~]# cat "rpmbuild/SPECS/skript.spec"
Name:           skript
Version:        1.0
Release:        0%{?dist}
Summary:        test

Group:          learning
License:        Public Domain
URL:            http://strachota.net
Source0:        skript-1.0.tar.gz


%description
testovaci skript

%prep
%setup -q


%install
rm -rf $RPM_BUILD_ROOT
mkdir -p "$RPM_BUILD_ROOT/usr/bin"
cp -r * "$RPM_BUILD_ROOT/usr/bin"

%clean
rm -rf $RPM_BUILD_ROOT


%files
/usr/bin/skript.sh
%defattr(-,root,root,-)
%doc



%changelog   